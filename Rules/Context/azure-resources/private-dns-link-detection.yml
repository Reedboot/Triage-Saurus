rules:
  - id: context-azure-private-dns-link
    message: |
      Azure Private DNS virtual network link detected.
    severity: INFO
    languages: [terraform, hcl]
    pattern-either:
      - pattern: |
          resource "azurerm_private_dns_zone_virtual_network_link" $NAME {
            ...
            private_dns_zone_name = $ZONE
            ...
            virtual_network_id = $VNET
            ...
          }
      - patterns:
          - pattern: |
              module $MOD {
                ...
                source = $SRC
                ...
              }
          - metavariable-regex:
              metavariable: $SRC
              regex: "(?i).*private[_-]?dns[_-]?link.*"
    metadata:
      rule_type: context_discovery
      category: networking
      subcategory: private_dns
      technology: [terraform, azure, dns]
      target_files: ["*.tf", "**/*.tf"]
      extracts:
        service_type: Private DNS VNet Link
        resource_type: azurerm_private_dns_zone_virtual_network_link
        resource_name: $NAME
        properties:
          - name: private_dns_zone_name
            pattern: private_dns_zone_name = "$ZONE"
          - name: virtual_network_id
            pattern: virtual_network_id = $VNET
    description: |
      Detects Azure Private DNS zone virtual network links or related modules to capture network resolution dependencies.

