rules:
  - id: context-azure-storage-container
    message: |
      Azure Storage Container detected in infrastructure.
    severity: INFO
    languages: [terraform, hcl]
    pattern-either:
      - pattern: |
          resource "azurerm_storage_container" $NAME {
            ...
            storage_account_name = $ACCOUNT
            ...
          }
      - pattern: |
          resource "azurerm_storage_container" $NAME {
            ...
            storage_account_id = $ACCOUNT_ID
            ...
          }
      - patterns:
          - pattern: |
              module $MOD {
                ...
                source = $SRC
                ...
              }
          - metavariable-regex:
              metavariable: $SRC
              regex: "(?i).*storage[_-]?container.*"
    metadata:
      rule_type: context_discovery
      category: infrastructure
      subcategory: storage_container
      technology: [terraform, azure, storage]
      target_files: ["*.tf", "**/*.tf"]
      extracts:
        service_type: Storage Container
        resource_type: azurerm_storage_container
        resource_name: $NAME
        properties:
          - name: storage_account_name
            pattern: storage_account_name = "$ACCOUNT"
          - name: storage_account_id
            pattern: storage_account_id = $ACCOUNT_ID
          - name: container_access_type
            pattern: container_access_type = "$ACCESS"
    description: |
      Detects Azure Storage Container resources or modules and records links back to the parent storage account.
