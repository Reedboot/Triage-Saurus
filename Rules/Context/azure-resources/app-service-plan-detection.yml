rules:
  - id: context-azure-app-service-plan
    message: |
      Azure App Service Plan detected in infrastructure.
    severity: INFO
    languages: [terraform, hcl]
    pattern-either:
      - pattern: |
          resource "azurerm_service_plan" $NAME {
            ...
            location = $LOCATION
            ...
          }
      - patterns:
          - pattern: |
              module $MOD {
                ...
                source = $SRC
                ...
              }
          - metavariable-regex:
              metavariable: $SRC
              regex: "(?i).*app[_-]?service[_-]?plan.*"
    metadata:
      rule_type: context_discovery
      category: infrastructure
      subcategory: app_service_plan
      technology: [terraform, azure, app_service]
      target_files: ["*.tf", "**/*.tf"]
      extracts:
        service_type: App Service Plan
        resource_type: azurerm_service_plan
        resource_name: $NAME
        properties:
          - name: location
            pattern: location = "$LOCATION"
          - name: os_type
            pattern: os_type = "$OS"
          - name: sku_name
            pattern: sku_name = "$SKU"
          - name: worker_count
            pattern: worker_count = $WORKERS
    description: |
      Detects Azure App Service Plan (serverfarms) resources or modules to capture hosting capacity context.

