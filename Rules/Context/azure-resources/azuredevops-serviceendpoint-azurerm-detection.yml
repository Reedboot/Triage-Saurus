rules:
  - id: context-azuredevops-serviceendpoint-azurerm
    message: |
      Azure DevOps AzureRM service connection detected.
    severity: INFO
    languages: [terraform, hcl]
    pattern: |
      resource "azuredevops_serviceendpoint_azurerm" $NAME {
        ...
        project_id = $PROJECT
        ...
        service_endpoint_name = "$ENDPOINT"
        ...
      }
    metadata:
      rule_type: context_discovery
      category: devops
      subcategory: service_connection
      technology: [terraform, azuredevops, azure]
      target_files: ["*.tf", "**/*.tf"]
      extracts:
        service_type: Azure DevOps AzureRM Service Connection
        resource_type: azuredevops_serviceendpoint_azurerm
        resource_name: $NAME
        properties:
          - name: project_id
            pattern: project_id = $PROJECT
          - name: service_endpoint_name
            pattern: service_endpoint_name = "$ENDPOINT"
          - name: service_endpoint_authentication_scheme
            pattern: service_endpoint_authentication_scheme = "$SCHEME"
    description: |
      Detects Azure DevOps AzureRM service endpoints that grant pipelines access to Azure subscriptions/tenants.
