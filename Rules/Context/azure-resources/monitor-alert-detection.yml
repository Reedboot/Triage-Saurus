rules:
  - id: context-azure-monitor-scheduled-query-alert
    message: |
      Azure Monitor scheduled query alert detected.
    severity: INFO
    languages: [terraform, hcl]
    pattern-either:
      - pattern: |
          resource "azurerm_monitor_scheduled_query_rules_alert_v2" $NAME {
            ...
            query = $QUERY
            ...
          }
      - pattern: |
          resource "azurerm_monitor_scheduled_query_rules_alert" $NAME {
            ...
            data_source_id = $DATA
            ...
          }
      - pattern: |
          resource "azurerm_monitor_metric_alert" $NAME {
            ...
            scopes = [$SCOPE, ...]
            ...
          }
      - patterns:
          - pattern: |
              module $MOD {
                ...
                source = $SRC
                ...
              }
          - metavariable-regex:
              metavariable: $SRC
              regex: "(?i).*monitor[_-]?(alert|metric).*"
    metadata:
      rule_type: context_discovery
      category: observability
      subcategory: monitoring
      technology: [terraform, azure, monitor]
      target_files: ["*.tf", "**/*.tf"]
      extracts:
        service_type: Monitor Scheduled Query Alert
        resource_type: azurerm_monitor_scheduled_query_rules_alert_v2
        resource_name: $NAME
    description: |
      Detects custom Azure Monitor alerts to understand observability coverage.
