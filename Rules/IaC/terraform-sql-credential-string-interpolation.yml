rules:
  - id: terraform-sql-credential-string-interpolation
    message: |
      SQL query built with format() or string interpolation containing secrets.
      This can lead to SQL injection and credential leakage in logs.
      Use parameterized queries instead.
    severity: WARNING
    languages: [terraform, hcl]
    patterns:
      - pattern-either:
          - pattern: format("... INSERT ... VALUES ... %s ...", $SECRET)
          - pattern: format("... UPDATE ... SET ... = '%s' ...", $SECRET)
          - pattern: '"... ${$SECRET} ..."'
      - metavariable-regex:
          metavariable: $SECRET
          regex: .*(password|secret|key|token|credential).*
    metadata:
      category: security
      subcategory: [injection, secrets]
      cwe: CWE-89
      confidence: MEDIUM
      likelihood: MEDIUM
      impact: MEDIUM
      technology: [terraform, sql]
