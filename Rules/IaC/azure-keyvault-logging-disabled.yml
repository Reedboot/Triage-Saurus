rules:
  - id: azure-keyvault-logging-disabled
    message: |
      Key Vault does not have diagnostic settings configured.
      Secret access and key operations will not be logged.
      Add azurerm_monitor_diagnostic_setting resource.
    severity: WARNING
    languages: [terraform, hcl]
    patterns:
      - pattern: |
          resource "azurerm_key_vault" "$NAME" {
            ...
          }
      - pattern-not-inside: |
          resource "azurerm_monitor_diagnostic_setting" "..." {
            target_resource_id = azurerm_key_vault.$NAME.id
            ...
          }
    metadata:
      category: security
      subcategory: [audit-logging, cloud]
      cwe: CWE-778
      confidence: HIGH
      likelihood: MEDIUM
      impact: MEDIUM
      technology: [terraform, azure]
      five_pillars: Pillar 3 (Audit Logging)
      compliance: [pci-dss, gdpr, soc2]
