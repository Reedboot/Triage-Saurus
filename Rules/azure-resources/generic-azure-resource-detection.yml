rules:
  - id: context-azure-resources-generic
    message: |
      Azure resource detected in Terraform configuration.
      This generic rule extracts ALL Azure resources for LLM interpretation.
    severity: INFO
    languages: [terraform, hcl]
    pattern: |
      resource "$PROVIDER_$TYPE" $NAME {
        ...
      }
    pattern-regex: |
      resource\s+"azurerm_([a-z_]+)"\s+"([a-z0-9_-]+)"\s*\{
    metadata:
      rule_type: context_discovery
      category: infrastructure
      subcategory: generic
      technology: [terraform, azure]
      target_files: ["*.tf", "**/*.tf"]
      requires_llm: true
      llm_prompt: |
        Interpret this Azure resource type and categorize it.
        
        Resource type: ${resource_type}
        Resource name: ${resource_name}
        
        Provide:
        1. Friendly service name (e.g., "azurerm_mssql_server" → "SQL Server")
        2. Service category (database, storage, compute, networking, security, etc.)
        3. Whether this is a critical security-relevant service
        4. What security rules should be considered for this resource
        
        Format:
        {
          "service_name": "SQL Server",
          "category": "database",
          "security_relevant": true,
          "suggested_security_rules": ["sql-auditing", "sql-firewall", "sql-aad-auth"]
        }
      extracts:
        provider: azurerm
        resource_type: $TYPE
        resource_name: $NAME
        raw_block: Full resource block for property extraction
      description: |
        Generic Azure resource detector that captures ALL azurerm_* resources.
        The LLM interprets the resource_type to provide friendly names and categorization.
        
        This replaces 100+ specific detection rules with 1 generic rule + LLM intelligence.
        
        Examples:
        - azurerm_mssql_server → "SQL Server" (database)
        - azurerm_key_vault → "Key Vault" (security/secrets-management)
        - azurerm_storage_account → "Storage Account" (storage)
        - azurerm_kubernetes_cluster → "AKS Cluster" (container-orchestration)
